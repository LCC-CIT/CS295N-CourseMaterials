<!DOCTYPE html><html>  <head>    <meta http-equiv="content-type" content="text/html; charset=UTF-8">    <title>Week 9, Day 2, Validation</title>    <style type="text/css">body {  font-family: "Arial", "Helvetica", "sans-serif";}footer {	font-size:smaller;	font-variant:small-caps;}#week10 {  background-color: #f8ff2e;}code {  display:block;  font-size: larger;  background-color: lightgoldenrodyellow;  max-height:450px;  width:85%;  overflow:scroll;  margin:0.5%;}      ul {   margin:0.5%;}      h2, h3, h4 {   display:inline;}      .exercise {  background-color: #c6ffe2;}</style> </head>  <body> <b>CS295N Web Development 1: ASP.NET </b><br>    <b> </b>    <header>      <div>Brian Bird</div>      <h1> <i><b>Validation</b></i></h1>      <b>Where we are </b>      <table style="width: 807px; height: 127px;" border="1">        <tbody>          <tr>            <td id="week01">1. Intro to MVC</td>            <td id="week06">6. Unit Testing and Repositories</td>          </tr>          <tr>            <td id="week02">2. Domain Modeling</td>            <td id="week07">7. Entity Framework (EF)</td>          </tr>          <tr>            <td id="week03">3. C# Review / Advanced C# for MVC</td>            <td id="week08">8. More on EF + Publishing to Azure</td>          </tr>          <tr>            <td id="week04">4. Razor Views and Tag Helpers</td>            <td id="week09">9. LINQ</td>          </tr>          <tr>            <td id="week05">5. Azure, Web Dev Tools and Debugging</td>            <td id="week10">10. Validation</td>          </tr>        </tbody>      </table>      <br>      <h2><b>Contents</b></h2>      <div>        <ul>          <b>            <li><a href="#topic1">Introduction</a></li>            <li><a href="#topic2">Review - LINQ </a></li>            <li><a href="#topic3a">Validation</a></li>            <li><a href="#topic6">Examples</a></li>            <li><a href="#topic7">References</a></li>          </b>        </ul>      </div>    </header>    <br>    <hr><br>    <section>      <article id="topic1">        <h2>Introduction</h2>        <ul>          <li>Announcements            <ul>              <li><a href="http://openeugene.org" target="_blank">Open Eugene                  Festival</a> </li>            </ul>          </li>        </ul>        <ul>          <li>Discuss questions about lab 8 - Seed data and publishing to Azure            with a Db</li>          <li>Review lab due dates on Moodle - lab 9 will be due this week.</li>          <li>Term Project - Presentations on Monday at class time</li>        </ul>        <p>We will finish up last week's topic of validation.</p>        <ul>        </ul>      </article>      <hr><br>      <article id="topic4a">        <h2>Review</h2>        <p><b><u>LINQ</u></b></p>        <article id="topic1" style="caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;">          <p><u><b>C# Attributes</b></u></p>          <ul>            <ul>              <ul>              </ul>            </ul>            <li>Programming Guide:<span class="Apple-converted-space">&nbsp;</span><a                href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/attributes/">C#
                Attributes</a></li>            <li>Attributes are a means of associating metadata with code</li>            <ul>              <li>Metadata is additional information about types defined in your                program (and remember that classes are types).</li>              <li>Attributes are declarative.</li>              <li>Attributes can be applied to assemblies (think DLLs), classes,                methods, and properties.<br>                <code style="font-size: larger; background-color: lightgoldenrodyellow;">[BindProperty]<br>                  public Movie Movie { get; set; }</code></li>              <li>Attributes can accept arguments.<br>                <code style="font-size: larger; background-color: lightgoldenrodyellow;">[attribute(positional_parameters,
                  name_parameter = value, ...)]</code></li>              <ul>                <li>Example using positional parameters:<br>                  <code style="font-size: larger; background-color: lightgoldenrodyellow;">[ObsoleteAttribute("This
                    method is deprecated", false)]<br>                    public void AnOutdatedMethod()</code></li>              </ul>              <ul>                <li>Example using named parameters:<br>                  <code style="font-size: larger; background-color: lightgoldenrodyellow;">[ObsoleteAttribute(Message
                    = "This method is deprecated", IsError = false)]<br>                    public void AnOutdatedMethod()</code></li>                <li>API Reference:<span class="Apple-converted-space">&nbsp;</span><a                    href="https://docs.microsoft.com/en-us/dotnet/api/system.obsoleteattribute?view=netcore-2.0">ObsoleteAttribute</a></li>              </ul>              <ul>              </ul>              <ul>              </ul>            </ul>          </ul>          <p></p>          <code style="font-size: larger; background-color: lightgoldenrodyellow;"></code></article>        <p></p>        <ul>        </ul>        <ul>        </ul>      </article>      <hr><br>      <h2> Validation </h2>      <br>      <ul>        <li>Validation is expected in the browser (for good UX), required on the          server (for security)</li>        <li>Good UX design provides a way for users to easily fix entry errors</li>        <li>In ASP.NET MVC, validation is done on the models</li>        <li>Implemented using C# attributes â€“ in MVC they are called <i>data            annotations</i></li>      </ul>      <p style="caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;"><u><b>Data
            Annotations<span class="Apple-converted-space">&nbsp;</span></b></u></p>      <ul style="caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;">        <li>API Reference:<span class="Apple-converted-space">&nbsp;</span><a href="https://docs.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations?view=netcore-2.0">System.ComponentModel.DataAnnotations
            Namespace</a></li>        <ul>          <li>Most of these attributes are for validation</li>        </ul>      </ul>      <u><br>        <b>Validation Using Data Annotations</b></u><br>      <b> </b><br>      <ul style="caret-color: rgb(0, 0, 0); color: rgb(0, 0, 0); font-family: Arial, Helvetica, sans-serif; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; text-decoration: none;">        <li>Validation is specified on the data model and is then enforced in          multiple places:</li>        <ul>          <li>In the database</li>          <li>In HTML form elements in the browser using jQuery validate</li>          <li>In HTTP Requests processed on the server (in case JavaScript is            disabled in the browser)</li>          <ul>            <li>Add a break-point to a request method to test this</li>            <li>Test this again after<span class="Apple-converted-space">&nbsp;</span><a                href="https://www.wikihow.com/Disable-JavaScript">disabling
                JavaScript</a></li>          </ul>        </ul>        <li>Validation Example:<br>          <code style="font-size: larger; background-color: lightgoldenrodyellow;">[StringLength(60,
            MinimumLength = 3)]<br>            [Required]<br>            public string Title { get; set; }</code></li>      </ul>      <br>      <u>Validation in the Controller</u><br>      <ul>        <li> Explicit Validation: You add the validation code to a controller          method yourself          <ul>            <li>Example: <code>if (string.IsNullOrEmpty(appt.ClientName)) {<br>                &nbsp;&nbsp;&nbsp;&nbsp;                ModelState.AddModelError(nameof(appt.ClientName), "Please enter                your name");</code> </li>          </ul>        </li>        <ul>          <li>Model State Dictionary            <ul>              <ul>              </ul>              <li> AddModelError(property, message) This method is used to                record a model validation error for the specified property.</li>              <ul>              </ul>              <li>GetValidationState(property) This method is used to determine                whether there are model validation errors for a specific                property, expressed as a value from the ModelValidationState                enumeration.                <ul>                  <li>Unvalidated This value means that no validation has been                    performed on the model property, usually because there was                    no value in the request that corresponded to the property                    name.</li>                  <li>Valid This value means that the request value associated                    with the property is valid.</li>                  <li>Invalid This value means that the request value associated                    with the property is invalid and should not be used.</li>                  <li>Skipped This value means that the model property has not                    been processed, which usually means that there have been so                    many validation errors that there is no point continuing to                    perform validation checks.</li>                </ul>              </li>              <ul>              </ul>              <li>IsValid This property returns true if all the model properties                are valid and returns false otherwise.</li>            </ul>          </li>        </ul>        <li> Make decisions based on Model Validation<br>          Example:<br>          <code> &nbsp;if (ModelState.IsValid)&nbsp; {<br>            &nbsp;&nbsp;&nbsp;&nbsp; repo.AddBook(book);&nbsp; <br>            &nbsp;}</code></li>      </ul>      <br>      <u> Displaying Validation Errors in the View</u><br>      <br>      <ul>        <li>Requires a strongly typed view and model binding using asp-for tag          helpers</li>        <li>Requires special Microsoft jQuery functions:<br>          <code> &lt;scriptsrc="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.2.0.min.js"&gt;&lt;/script&gt;<br>            &lt;scriptsrc="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.16.0/jquery.validate.min.js"&gt;&lt;/script&gt;<br>            &lt;scriptsrc="https://ajax.aspnetcdn.com/ajax/jquery.validation.unobtrusive/3.2.6/jquery.validate.unobtrusive.min.js"&gt;&lt;/script&gt;</code></li>        <li>Tag Helpers that display validation errors</li>        <ul>          <li>Summary<br>            <code>â‰ˆ&lt;div asp-validation-summary="ModelOnly"&gt;&lt;/div&gt;</code></li>        </ul>        <ul>          <li>Individual field<br>            <code>&lt;label asp-for="ClientName"&gt;Your name:&lt;/label&gt;<br>              &lt;div&gt;&lt;span              asp-validation-for="ClientName"&gt;&lt;/span&gt;&lt;/div&gt;<br>              &lt;input asp-for="ClientName" /&gt;</code></li>        </ul>      </ul>      <br>      <u>Notes<br>        <br>      </u> All non-nullable model fields are required by default. <br>      Make fields nullable by adding ?&nbsp; to the typeâ€“ this will also make      them nullable in the database.<br>      <br>      <u>Improve the publication date display for books</u><br>      <code> [DataType(DataType.Date)]<br>        [DisplayFormat(ApplyFormatInEditMode = true, DataFormatString =        "{0:MM/dd/yyyy}")]</code><a href="https://docs.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations.displayformatattribute?view=netcore-2.1"        target="_blank">DisplayFormatAttribute
        Class</a><br>      <br>      Add a migration after adding validation annotations that change the      database schema<br>      <span style="font-family: Courier New,Courier,monospace;">dotnet ef        migrations add NewMigrationName<br>        <br>      </span>      <hr> <br>      <article id="topic6">        <h2>Example</h2>        <br>        <ul>          <li> <a href="https://github.com/LCC-CIT/CS295N-Bookinfo-Core-21/tree/Validation"              target="_blank"><span                style="color: #0000ee;">https://github.com/LCC-CIT/CS295N-Bookinfo-Core-21/tree/Validation</span></a></li>        </ul>      </article>      <br>      <hr> <br>      <article id="topic8">        <h2>References</h2>        <ul>          <li>Textbook - <span style="font-style: italic;">Pro ASP.NET Core MVC              2.0</span>, Adam Freeman, Apress, 2017.<br>            Ch. 27 "Model Validation"</li>          <li><a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/validation?view=aspnetcore-2.1"              target="_blank">Tutorial:
              Model validation in ASP.NET Core MVC <br>            </a></li>          <li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations?view=netcore-2.1"              target="_blank">Reference:
              System.ComponentModel.DataAnnotations Namespace</a></li>        </ul>        <p><br>        </p>        <ul>        </ul>      </article>    </section>    <footer>      <hr style="width: 100%; height: 2px;"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img          alt="Creative Commons License"          style="border-width:0"          src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a><br>      <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">ASP.NET        Core MVC Lecture Notes</span> by <a xmlns:cc="http://creativecommons.org/ns#"        href="https://birdsbits.blog"        property="cc:attributionName"        rel="cc:attributionURL">Brian
        Bird</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
        Commons Attribution-ShareAlike 4.0 International License</a>. </footer>    <hr>  </body></html>